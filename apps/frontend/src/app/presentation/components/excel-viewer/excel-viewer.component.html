@if (excelFile()) {
    <div class="excel-viewer-container">
        <table mat-table [dataSource]="dataSource" class="excel-table">
            <ng-container matColumnDef="{{displayedColumns[0]}}" sticky>
                <th mat-header-cell *matHeaderCellDef>
                    {{displayedColumns[0]}}
                </th>
                <td mat-cell *matCellDef="let row">
                    {{row[displayedColumns[0]]}}
                </td>
            </ng-container>
            @for (column of displayedColumns; track column; let i = $index) {
                @if (i !== 0) {
                    <ng-container matColumnDef="{{column}}">
                        <th mat-header-cell *matHeaderCellDef
                            [class]="getColumnClass(i)"
                            (click)="onColumnHeaderClick($event, i)"
                            [attr.aria-label]="'Select column ' + column + ' as ' + (getColumnClass(i) === 'question-column' ? 'questions' : getColumnClass(i) === 'answer-column' ? 'answers' : '')">
                            {{column}}
                        </th>
                        <td mat-cell *matCellDef="let row; let rowIndex = index"
                            [class]="getColumnClass(i)"
                            [class.unreliable-cell]="isCellUnreliable(rowIndex, i)"
                            (click)="onCellClick($event, rowIndex, i)">
                            {{row[column]}}
                        </td>
                    </ng-container>
                }
            }

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Context Menu -->
        <div style="visibility: hidden; position: fixed"
            [style.left]="contextMenuPosition.x"
            [style.top]="contextMenuPosition.y"
            [matMenuTriggerFor]="contextMenu">
        </div>

        <mat-menu #contextMenu="matMenu">
            <ng-template matMenuContent let-columnIndex="columnIndex">
                <button mat-menu-item (click)="selectColumnCategory(columnIndex, 'questions')">
                    <span>Mark as Questions Column</span>
                </button>
                <button mat-menu-item (click)="selectColumnCategory(columnIndex, 'answers')">
                    <span>Mark as Answers Column</span>
                </button>
            </ng-template>
        </mat-menu>
    </div>
} @else {
    <div class="no-file-message">
        No Excel file loaded
    </div>
}